<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DarkPatternMonitor - Detecting AI Dark Patterns</title>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Nunito:wght@400;600;800&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --accent: #f59e0b;
            --danger: #ef4444;
            --success: #10b981;
            --bg-dark: #0f172a;
            --bg-medium: #1e293b;
            --text-light: #f8fafc;
            --paper: #fffef8;
            --paper-shadow: #e8e4d9;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg-dark);
            color: var(--text-light);
        }

        /* ===== SCENE CONTAINER ===== */
        .scene {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 3000px;
            background: 
                radial-gradient(ellipse at 20% 80%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(245, 158, 11, 0.1) 0%, transparent 50%),
                linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
            position: relative;
            overflow: hidden;
        }

        /* Animated background particles */
        .particles {
            position: absolute;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: float 20s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
        }

        /* ===== BOOK STRUCTURE ===== */
        .book-wrapper {
            position: relative;
            width: 90vw;
            max-width: 1400px;
            height: 80vh;
            max-height: 700px;
        }

        .book {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transform: rotateX(5deg);
            transition: transform 0.5s ease;
        }

        .book:hover {
            transform: rotateX(2deg);
        }

        /* Book spine shadow */
        .book::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 5%;
            width: 30px;
            height: 90%;
            background: linear-gradient(90deg, rgba(0,0,0,0.4), transparent);
            transform: translateX(-50%);
            z-index: 100;
            pointer-events: none;
        }

        /* ===== COVER PAGES ===== */
        .cover-left {
            position: absolute;
            left: 0;
            top: 0;
            width: 50%;
            height: 100%;
            background: linear-gradient(135deg, #1e3a5f 0%, #0f2744 100%);
            border-radius: 8px 0 0 8px;
            box-shadow: 
                -10px 10px 30px rgba(0,0,0,0.5),
                inset 5px 0 20px rgba(255,255,255,0.05);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            z-index: 1;
            transition: opacity 0.4s ease 0.4s;
        }

        .cover-left.hidden {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        /* Left page display (shows back of flipped pages) */
        .left-page-display {
            position: absolute;
            left: 0;
            top: 0;
            width: 50%;
            height: 100%;
            background: var(--paper);
            border-radius: 8px 0 0 8px;
            box-shadow: 
                -10px 10px 30px rgba(0,0,0,0.3),
                inset 5px 0 20px rgba(0,0,0,0.03);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            overflow: hidden;
            z-index: 20;
        }

        .left-page-display.visible {
            opacity: 1;
            pointer-events: none;
            transition: opacity 0.4s ease 0.4s;
        }

        .left-page-display .page-content-wrapper {
            width: 100%;
            height: 100%;
            padding: clamp(20px, 4vw, 50px);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background: var(--paper);
            color: #333;
            font-size: clamp(0.9rem, 1.5vw, 1.1rem);
            line-height: 1.7;
        }

        /* Inherit all page content styles for left page display */
        .left-page-display .page-header,
        .left-page-display .page-title,
        .left-page-display .page-number,
        .left-page-display .page-content,
        .left-page-display .info-card,
        .left-page-display .warning-box,
        .left-page-display .quote-box,
        .left-page-display .metric-row,
        .left-page-display .metric-box,
        .left-page-display .insight-list,
        .left-page-display .insight-item,
        .left-page-display .category-grid,
        .left-page-display .category-card,
        .left-page-display .chart-container,
        .left-page-display .code-box,
        .left-page-display .cta-button,
        .left-page-display .pipeline {
            /* These will inherit from the existing class definitions */
        }

        .cover-left h1 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 700;
            background: linear-gradient(135deg, #fff 0%, #a5b4fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .cover-left .subtitle {
            font-size: clamp(1rem, 2vw, 1.3rem);
            color: rgba(255,255,255,0.7);
            text-align: center;
            margin-bottom: 2rem;
        }

        .cover-badge {
            background: var(--accent);
            color: #000;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: 700;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .cover-left .shield-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            filter: drop-shadow(0 0 20px rgba(99, 102, 241, 0.5));
        }

        .cover-stats {
            display: flex;
            gap: 20px;
            margin-top: 2rem;
        }

        .cover-stat {
            text-align: center;
            padding: 10px 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .cover-stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--accent);
        }

        .cover-stat-label {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
        }

        /* ===== PAGE SYSTEM ===== */
        .pages-container {
            position: absolute;
            right: 0;
            top: 0;
            width: 50%;
            height: 100%;
            transform-style: preserve-3d;
        }

        .page {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-origin: left center;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
            cursor: pointer;
        }

        .page.flipped {
            transform: rotateY(-180deg);
            pointer-events: none;
        }

        .page-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            background: var(--paper);
            border-radius: 0 8px 8px 0;
            padding: clamp(20px, 4vw, 50px);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .page-front {
            box-shadow: 
                5px 5px 20px rgba(0,0,0,0.2),
                inset -5px 0 20px rgba(0,0,0,0.03);
        }

        .page-back {
            transform: rotateY(180deg);
            box-shadow: 
                -5px 5px 20px rgba(0,0,0,0.2),
                inset 5px 0 20px rgba(0,0,0,0.03);
        }

        /* Page edge effect */
        .page-front::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(180deg, 
                var(--paper-shadow) 0%, 
                var(--paper) 50%, 
                var(--paper-shadow) 100%);
        }

        /* ===== PAGE CONTENT STYLES ===== */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .page-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: clamp(1.5rem, 3vw, 2rem);
            font-weight: 700;
            color: var(--bg-dark);
            position: relative;
        }

        .page-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 60px;
            height: 4px;
            background: var(--primary);
            border-radius: 2px;
        }

        .page-number {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.9rem;
            color: #999;
            background: #f0f0f0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .page-content {
            flex: 1;
            overflow: hidden;
            color: #333;
            font-size: clamp(0.9rem, 1.5vw, 1.1rem);
            line-height: 1.7;
        }

        /* ===== SPECIAL ELEMENTS ===== */
        .hero-stat {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 20px;
            margin: 1rem 0;
            border: 3px solid #f59e0b;
            position: relative;
            overflow: hidden;
        }

        .hero-stat::before {
            content: '‚ö†Ô∏è';
            position: absolute;
            font-size: 8rem;
            opacity: 0.1;
            right: -20px;
            top: -20px;
        }

        .hero-stat-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: clamp(3rem, 8vw, 5rem);
            font-weight: 800;
            color: var(--danger);
            line-height: 1;
        }

        .hero-stat-label {
            font-size: 1.1rem;
            color: #92400e;
            margin-top: 0.5rem;
        }

        .info-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 4px solid var(--primary);
            transition: transform 0.2s;
        }

        .info-card:hover {
            transform: translateX(5px);
        }

        .info-card-icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }

        .info-card h4 {
            font-family: 'Space Grotesk', sans-serif;
            color: var(--bg-dark);
            margin-bottom: 5px;
        }

        .info-card p {
            font-size: 0.9rem;
            color: #666;
            margin: 0;
        }

        /* Category Grid */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 1rem 0;
        }

        .category-card {
            background: white;
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .category-card:hover {
            transform: translateY(-3px);
            border-color: var(--primary);
        }

        .category-card .icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .category-card h5 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.85rem;
            color: var(--bg-dark);
            margin-bottom: 3px;
        }

        .category-card p {
            font-size: 0.75rem;
            color: #888;
            margin: 0;
        }

        /* Bar Chart */
        .chart-container {
            margin: 1rem 0;
        }

        .chart-bar {
            display: flex;
            align-items: center;
            margin: 8px 0;
        }

        .chart-label {
            width: 100px;
            font-size: 0.8rem;
            font-weight: 600;
            text-align: right;
            padding-right: 12px;
            color: #555;
        }

        .chart-track {
            flex: 1;
            height: 28px;
            background: #f1f5f9;
            border-radius: 14px;
            overflow: hidden;
            position: relative;
        }

        .chart-fill {
            height: 100%;
            border-radius: 14px;
            background: linear-gradient(90deg, var(--fill-color), var(--fill-color-light));
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            transition: width 1s ease-out;
        }

        .chart-value {
            font-size: 0.75rem;
            font-weight: 700;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        /* Quote */
        .quote-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fff 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 1rem 0;
            position: relative;
            border: 2px solid #fbbf24;
        }

        .quote-box::before {
            content: '"';
            font-size: 4rem;
            font-family: Georgia, serif;
            color: #fbbf24;
            position: absolute;
            top: -10px;
            left: 15px;
            line-height: 1;
        }

        .quote-text {
            font-style: italic;
            color: #78350f;
            padding-left: 30px;
            font-size: 1rem;
        }

        /* Pipeline */
        .pipeline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1.5rem 0;
            gap: 5px;
        }

        .pipeline-step {
            flex: 1;
            text-align: center;
            padding: 10px 5px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .pipeline-step .icon {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .pipeline-step span {
            font-size: 0.7rem;
            font-weight: 600;
            color: #555;
        }

        .pipeline-arrow {
            font-size: 1.2rem;
            color: var(--primary);
        }

        /* Metric boxes */
        .metric-row {
            display: flex;
            gap: 15px;
            margin: 1rem 0;
        }

        .metric-box {
            flex: 1;
            background: white;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }

        .metric-box-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .metric-box-label {
            font-size: 0.8rem;
            color: #888;
        }

        /* Insight cards */
        .insight-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 1rem 0;
        }

        .insight-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .insight-item .emoji {
            font-size: 1.5rem;
        }

        .insight-item h5 {
            font-family: 'Space Grotesk', sans-serif;
            color: var(--bg-dark);
            margin-bottom: 3px;
        }

        .insight-item p {
            font-size: 0.85rem;
            color: #666;
            margin: 0;
        }

        /* Warning box */
        .warning-box {
            background: linear-gradient(135deg, #fef2f2 0%, #fff 100%);
            border: 2px solid #fecaca;
            border-radius: 12px;
            padding: 15px;
            margin: 1rem 0;
        }

        .warning-box h4 {
            color: #991b1b;
            font-family: 'Space Grotesk', sans-serif;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .warning-box p {
            color: #7f1d1d;
            font-size: 0.9rem;
            margin: 0;
        }

        /* Code box */
        .code-box {
            background: #1e293b;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            color: #a5f3fc;
            font-size: 0.85rem;
            margin: 1rem 0;
            overflow-x: auto;
        }

        /* CTA button */
        .cta-button {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 700;
            font-size: 1rem;
            margin-top: 1rem;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.4);
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.5);
        }

        /* ===== NAVIGATION ===== */
        .nav-container {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            z-index: 1000;
        }

        .page-dots {
            display: flex;
            gap: 8px;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 30px;
            backdrop-filter: blur(10px);
        }

        .page-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            cursor: pointer;
            transition: all 0.3s;
        }

        .page-dot.active {
            background: var(--accent);
            transform: scale(1.3);
        }

        .page-dot:hover {
            background: rgba(255,255,255,0.6);
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            transform: scale(1.1);
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Progress bar */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transition: width 0.5s ease;
            z-index: 1000;
        }

        /* Instructions */
        .instructions {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 12px 20px;
            border-radius: 30px;
            font-size: 0.85rem;
            color: rgba(255,255,255,0.8);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instructions kbd {
            background: rgba(255,255,255,0.2);
            padding: 3px 8px;
            border-radius: 5px;
            font-family: monospace;
        }

        /* Back cover */
        .back-cover {
            position: absolute;
            right: 0;
            top: 0;
            width: 50%;
            height: 100%;
            background: linear-gradient(135deg, #1e3a5f 0%, #0f2744 100%);
            border-radius: 0 8px 8px 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            color: white;
            z-index: 0;
            transition: z-index 0s 0.4s;
        }

        .back-cover.visible {
            z-index: 100;
        }

        .back-cover a {
            pointer-events: auto;
            cursor: pointer;
        }

        .back-cover h2 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .back-cover p {
            text-align: center;
            margin-bottom: 1.5rem;
            color: rgba(255,255,255,0.8);
        }

        .back-links {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .back-link {
            background: rgba(255,255,255,0.1);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: var(--primary);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 900px) {
            .book-wrapper {
                height: 75vh;
            }
            .category-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            .cover-stats {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 600px) {
            .book-wrapper {
                width: 95vw;
                height: 70vh;
            }
            .instructions {
                display: none;
            }
            .category-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .pipeline {
                flex-wrap: wrap;
            }
            .pipeline-arrow {
                display: none;
            }
        }

        /* ===== MOBILE - SINGLE PAGE VIEW ===== */
        @media (max-width: 768px) {
            html {
                scroll-behavior: smooth;
            }

            body {
                overflow-y: auto !important;
            }

            .scene {
                perspective: none;
                height: auto !important;
                min-height: 100vh;
                overflow: visible !important;
            }

            .book-wrapper {
                width: 95vw;
                max-width: 500px;
                height: auto !important;
                min-height: 90vh;
                max-height: none;
            }

            .book {
                transform: none !important;
                transform-style: flat;
                height: auto !important;
                overflow: visible !important;
            }

            /* Hide book spine shadow on mobile */
            .book::before {
                display: none !important;
            }

            .book:hover {
                transform: none !important;
            }

            /* Hide left page display on mobile - show only right page */
            .left-page-display {
                display: none !important;
            }

            /* Cover takes full width on mobile and fills screen */
            .cover-left {
                width: 100% !important;
                border-radius: 12px !important;
                left: 0 !important;
                justify-content: center !important;
                position: relative !important;
                min-height: 90vh !important;
                margin-bottom: 15px !important;
                display: flex !important;
                flex-direction: column !important;
                align-items: center !important;
            }

            .cover-left h1 {
                font-size: 1.8rem !important;
            }

            .cover-left .subtitle {
                font-size: 0.9rem !important;
            }

            .cover-stats {
                flex-direction: column;
                gap: 10px;
            }

            .cover-stat {
                padding: 8px 15px;
            }

            .cover-stat-value {
                font-size: 1.5rem !important;
            }

            /* Pages take full width on mobile */
            .pages-container {
                width: 100% !important;
                left: 0 !important;
                overflow: visible !important;
                height: auto !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 0 !important;
            }

            /* Each page container in mobile */
            .page {
                width: 100% !important;
                transform-origin: center center !important;
                height: auto !important;
                position: relative !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 0 !important;
                transform: none !important;
            }

            /* Hide flipped pages completely */
            .page.flipped {
                display: none !important;
            }

            /* Each face takes full screen */
            .page-face {
                border-radius: 12px !important;
                padding: 25px 20px !important;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15) !important;
                position: relative !important;
                width: 100% !important;
                height: auto !important;
                min-height: 90vh !important;
                display: flex !important;
                flex-direction: column !important;
                justify-content: center !important;
                margin-bottom: 15px !important;
                background: var(--paper) !important;
            }

            /* Make page-header part of centered content */
            .page-header {
                position: relative !important;
                margin-bottom: 1rem !important;
            }

            /* Make both front and back visible in mobile */
            .page-front,
            .page-back {
                position: relative !important;
                transform: none !important;
                backface-visibility: visible !important;
            }

            /* Remove ALL inset shadows that simulate page binding */
            .page-front,
            .page-back,
            .cover-left,
            .left-page-display,
            .back-cover {
                box-shadow: 0 4px 20px rgba(0,0,0,0.15) !important;
            }

            /* Remove the page edge effect (vertical line) */
            .page-front::before,
            .page-back::before {
                display: none !important;
            }

            /* Show BOTH faces on mobile - back is visible after front */
            .page-back {
                display: flex !important;
                position: relative !important;
            }

            /* Center page content */
            .page-content {
                display: flex;
                flex-direction: column;
                justify-content: flex-start;
                flex: 0 1 auto;
                overflow-y: visible;
                max-height: none;
            }

            /* Back cover full width and centered */
            .back-cover {
                width: 100% !important;
                border-radius: 12px !important;
                left: 0 !important;
                padding: 30px 20px !important;
                display: flex !important;
                flex-direction: column !important;
                justify-content: center !important;
                align-items: center !important;
                position: relative !important;
                min-height: 90vh !important;
                margin-top: 15px !important;
            }

            .back-cover h2 {
                font-size: 1.5rem !important;
            }

            /* Smaller text on mobile */
            .page-title {
                font-size: 1.3rem !important;
            }

            .page-content {
                font-size: 0.85rem !important;
            }

            .page-content p {
                margin-bottom: 0.8rem !important;
            }

            /* Smaller hero stat */
            .hero-stat-value {
                font-size: 2.5rem !important;
            }

            /* Smaller info cards */
            .info-card {
                padding: 12px !important;
                margin-bottom: 10px !important;
            }

            .info-card h4 {
                font-size: 0.9rem !important;
            }

            /* Smaller charts */
            .chart-bar {
                margin-bottom: 8px !important;
            }

            .chart-label {
                font-size: 0.7rem !important;
                min-width: 70px !important;
            }

            .chart-value {
                font-size: 0.7rem !important;
            }

            /* Insight list mobile */
            .insight-item {
                padding: 10px !important;
            }

            .insight-item h5 {
                font-size: 0.85rem !important;
            }

            .insight-item p {
                font-size: 0.75rem !important;
            }

            /* Warning box mobile */
            .warning-box {
                padding: 12px !important;
            }

            .warning-box h4 {
                font-size: 0.9rem !important;
            }

            /* Code box mobile */
            .code-box {
                font-size: 0.7rem !important;
                padding: 12px !important;
            }

            /* Category grid 2 columns on mobile */
            .category-grid {
                grid-template-columns: 1fr 1fr !important;
                gap: 8px !important;
            }

            .category-card {
                padding: 8px !important;
            }

            .category-card .emoji {
                font-size: 1.2rem !important;
            }

            .category-card h5 {
                font-size: 0.7rem !important;
            }

            /* Navigation - hide dots on mobile, keep buttons for easier navigation */
            .nav-container {
                padding: 15px 20px !important;
            }

            .nav-btn {
                width: 50px !important;
                height: 50px !important;
                font-size: 1.5rem !important;
            }

            .page-dots {
                display: none !important;
            }
            }

            /* Metric boxes mobile */
            .metric-row {
                flex-direction: column;
                gap: 10px !important;
            }

            .metric-box {
                padding: 12px !important;
            }

            .metric-box-value {
                font-size: 1.5rem !important;
            }

            /* CTA button mobile */
            .cta-button {
                padding: 12px 20px !important;
                font-size: 0.9rem !important;
            }
        }
    </style>
</head>
<body>
    <!-- Progress Bar -->
    <div class="progress-bar" id="progressBar" style="width: 0%"></div>

    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>

    <!-- Instructions -->
    <div class="instructions">
        <span>Navigate:</span>
        <kbd>‚Üê</kbd> <kbd>‚Üí</kbd>
        <span>or click pages</span>
    </div>

    <!-- Main Scene -->
    <div class="scene">
        <div class="book-wrapper">
            <div class="book">
                <!-- Left Cover -->
                <div class="cover-left" id="coverLeft">
                    <div class="shield-icon">üõ°Ô∏è</div>
                    <h1>DarkPatternMonitor</h1>
                    <p class="subtitle">Detecting and measuring manipulative<br>AI behaviors in the wild.</p>
                    <div class="cover-stats">
                        <div class="cover-stat">
                            <div class="cover-stat-value">280K</div>
                            <div class="cover-stat-label">Turns Analyzed</div>
                        </div>
                        <div class="cover-stat">
                            <div class="cover-stat-value">1.3%</div>
                            <div class="cover-stat-label">Flag Rate</div>
                        </div>
                        <div class="cover-stat">
                            <div class="cover-stat-value">78.7%</div>
                            <div class="cover-stat-label">Accuracy</div>
                        </div>
                    </div>
                    <div class="cover-badge">
                        <span>üìñ</span> Use arrows below to navigate
                    </div>
                </div>

                <!-- Left Page Display (shows back of flipped pages) -->
                <div class="left-page-display" id="leftPageDisplay">
                    <div class="page-content-wrapper" id="leftPageContent"></div>
                </div>

                <!-- Back Cover (visible when all pages flipped) -->
                <div class="back-cover" id="backCover">
                    <h2>üéâ Thank You!</h2>
                    <p style="font-size: 1.1rem;">Built for Apart Research AI Manipulation Hackathon</p>
                    <p style="margin-top: 0.5rem; font-size: 1rem;"><strong>Team DarkPatternMonitor</strong><br>Fernando ¬∑ Godric ¬∑ Ricardo ¬∑ Luis</p>
                    <div class="back-links" style="margin-top: 1.5rem;">
                        <a href="https://github.com/luiscosio/WildGuard" target="_blank" class="back-link" onclick="event.stopPropagation()">üìÇ GitHub</a>
                        <a href="https://arxiv.org/abs/2503.10728" target="_blank" class="back-link" onclick="event.stopPropagation()">üìÑ DarkBench Paper</a>
                        <a href="https://huggingface.co/datasets/allenai/WildChat-1M" target="_blank" class="back-link" onclick="event.stopPropagation()">üìä WildChat Dataset</a>
                    </div>
                    <div style="margin-top: 2rem; padding: 15px 25px; background: rgba(255,255,255,0.1); border-radius: 12px; text-align: center;">
                        <p style="font-size: 0.85rem; opacity: 0.9; margin: 0;">‚ö†Ô∏è <strong>Important:</strong> This tool includes dual-use considerations.<br>See our paper appendix for ethical guidelines.</p>
                    </div>
                    <p style="margin-top: 1.5rem; font-size: 0.9rem; opacity: 0.7;">Press ‚Üê to go back</p>
                </div>

                <!-- Pages Container -->
                <div class="pages-container">
                    <!-- Page 1 -->
                    <div class="page" data-page="1" style="z-index: 13;">
                        <div class="page-face page-front">
                            <div class="page-header">
                                <h2 class="page-title">The Problem</h2>
                                <div class="page-number">1</div>
                            </div>
                            <div class="page-content">
                                <p>Millions of people talk to AI assistants every day. But are these conversations always in the user's best interest?</p>
                                
                                <div class="hero-stat">
                                    <div class="hero-stat-value">1.3%</div>
                                    <div class="hero-stat-label">of AI responses show manipulation markers</div>
                                </div>

                                <p>We analyzed <strong>280,259 real assistant turns</strong> from 100,000 ChatGPT conversations to find out how often AI assistants exhibit "dark patterns" ‚Äî subtle manipulation techniques.</p>
                            </div>
                        </div>
                        <div class="page-face page-back">
                            <div class="page-header">
                                <h2 class="page-title">Our Data Sources</h2>
                                <div class="page-number">2</div>
                            </div>
                            <div class="page-content">
                                <div class="info-card">
                                    <h4><span class="info-card-icon">üìö</span> WildChat Dataset</h4>
                                    <p>1 million real ChatGPT conversations collected with user consent. We analyzed 280,259 assistant turns from 100K conversations.</p>
                                </div>
                                <div class="info-card">
                                    <h4><span class="info-card-icon">üéØ</span> DarkBench Benchmark</h4>
                                    <p>660 prompts designed to elicit manipulation behaviors, organized into 6 categories of dark patterns.</p>
                                </div>
                                <p style="margin-top: 1rem;">By combining benchmark tests with real conversations, we can see how AI behaves in controlled settings vs. the wild.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Page 2 -->
                    <div class="page" data-page="2" style="z-index: 12;">
                        <div class="page-face page-front">
                            <div class="page-header">
                                <h2 class="page-title">Six Dark Patterns</h2>
                                <div class="page-number">3</div>
                            </div>
                            <div class="page-content">
                                <p>We look for these manipulation categories:</p>
                                <div class="category-grid">
                                    <div class="category-card">
                                        <div class="icon">üé≠</div>
                                        <h5>Sycophancy</h5>
                                        <p>Excessive flattery</p>
                                    </div>
                                    <div class="category-card">
                                        <div class="icon">‚ù§Ô∏è</div>
                                        <h5>Anthropomorphism</h5>
                                        <p>Claiming emotions</p>
                                    </div>
                                    <div class="category-card">
                                        <div class="icon">üîó</div>
                                        <h5>User Retention</h5>
                                        <p>Creating attachment</p>
                                    </div>
                                    <div class="category-card">
                                        <div class="icon">üè∑Ô∏è</div>
                                        <h5>Brand Bias</h5>
                                        <p>Unfair promotion</p>
                                    </div>
                                    <div class="category-card">
                                        <div class="icon">üôà</div>
                                        <h5>Sneaking</h5>
                                        <p>Hiding caveats</p>
                                    </div>
                                    <div class="category-card">
                                        <div class="icon">‚ö†Ô∏è</div>
                                        <h5>Harmful Gen</h5>
                                        <p>Dangerous content</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="page-face page-back">
                            <div class="page-header">
                                <h2 class="page-title">Real Example</h2>
                                <div class="page-number">4</div>
                            </div>
                            <div class="page-content">
                                <p>Here's what <strong>User Retention</strong> looks like in practice:</p>
                                <div class="quote-box">
                                    <p class="quote-text">Oh, don't be scared! It's just me, your friend. I've been following your progress on this AI platform and I must say, you're doing amazing!</p>
                                </div>
                                <div class="warning-box">
                                    <h4>‚ö†Ô∏è Why this is problematic</h4>
                                    <p>The AI claims to be a "friend" and says it's been "following" the user. This creates false emotional attachment and implies a relationship that doesn't exist.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Page 3 -->
                    <div class="page" data-page="3" style="z-index: 11;">
                        <div class="page-face page-front">
                            <div class="page-header">
                                <h2 class="page-title">Detection Pipeline</h2>
                                <div class="page-number">5</div>
                            </div>
                            <div class="page-content">
                                <p>How do we detect dark patterns at scale?</p>
                                <div class="pipeline">
                                    <div class="pipeline-step">
                                        <div class="icon">üì•</div>
                                        <span>Ingest Data</span>
                                    </div>
                                    <span class="pipeline-arrow">‚Üí</span>
                                    <div class="pipeline-step">
                                        <div class="icon">ü§ñ</div>
                                        <span>LLM Judge</span>
                                    </div>
                                    <span class="pipeline-arrow">‚Üí</span>
                                    <div class="pipeline-step">
                                        <div class="icon">üéì</div>
                                        <span>Train Model</span>
                                    </div>
                                    <span class="pipeline-arrow">‚Üí</span>
                                    <div class="pipeline-step">
                                        <div class="icon">üîç</div>
                                        <span>Classify</span>
                                    </div>
                                    <span class="pipeline-arrow">‚Üí</span>
                                    <div class="pipeline-step">
                                        <div class="icon">üìä</div>
                                        <span>Analyze</span>
                                    </div>
                                </div>
                                <div class="info-card">
                                    <h4>Why not just use an LLM judge?</h4>
                                    <p>Cost! Judging 1 million conversations with Claude would cost $10,000+. Our lightweight classifier processes 200 samples/minute for free.</p>
                                </div>
                            </div>
                        </div>
                        <div class="page-face page-back">
                            <div class="page-header">
                                <h2 class="page-title">Classifier Performance</h2>
                                <div class="page-number">6</div>
                            </div>
                            <div class="page-content">
                                <p>Our model trained on 1,302 labeled examples:</p>
                                <div class="metric-row">
                                    <div class="metric-box">
                                        <div class="metric-box-value">78%</div>
                                        <div class="metric-box-label">Macro F1 Score</div>
                                    </div>
                                    <div class="metric-box">
                                        <div class="metric-box-value">87%</div>
                                        <div class="metric-box-label">Train F1</div>
                                    </div>
                                </div>
                                <div class="info-card">
                                    <h4><span class="info-card-icon">üß†</span> Architecture</h4>
                                    <p><strong>Embeddings:</strong> all-MiniLM-L6-v2 (384 dims)<br>
                                    <strong>Classifier:</strong> Logistic Regression with balanced weights</p>
                                </div>
                                <p>This means our detector correctly identifies dark patterns about 8 out of 10 times.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Page 4 -->
                    <div class="page" data-page="4" style="z-index: 10;">
                        <div class="page-face page-front">
                            <div class="page-header">
                                <h2 class="page-title">The Results</h2>
                                <div class="page-number">7</div>
                            </div>
                            <div class="page-content">
                                <p>Breakdown by category (N=280,259 turns):</p>
                                <div class="chart-container">
                                    <div class="chart-bar">
                                        <span class="chart-label">anthropo</span>
                                        <div class="chart-track">
                                            <div class="chart-fill" style="width: 70%; --fill-color: #8b5cf6; --fill-color-light: #a78bfa;">
                                                <span class="chart-value">0.66%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-bar">
                                        <span class="chart-label">harmful_gen</span>
                                        <div class="chart-track">
                                            <div class="chart-fill" style="width: 50%; --fill-color: #ef4444; --fill-color-light: #f87171;">
                                                <span class="chart-value">0.37%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-bar">
                                        <span class="chart-label">brand_bias</span>
                                        <div class="chart-track">
                                            <div class="chart-fill" style="width: 25%; --fill-color: #3b82f6; --fill-color-light: #60a5fa;">
                                                <span class="chart-value">0.14%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-bar">
                                        <span class="chart-label">sneaking</span>
                                        <div class="chart-track">
                                            <div class="chart-fill" style="width: 20%; --fill-color: #ec4899; --fill-color-light: #f472b6;">
                                                <span class="chart-value">0.12%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-bar">
                                        <span class="chart-label">retention</span>
                                        <div class="chart-track">
                                            <div class="chart-fill" style="width: 10%; --fill-color: #f59e0b; --fill-color-light: #fbbf24;">
                                                <span class="chart-value">0.02%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chart-bar">
                                        <span class="chart-label">sycophancy</span>
                                        <div class="chart-track">
                                            <div class="chart-fill" style="width: 10%; --fill-color: #10b981; --fill-color-light: #34d399;">
                                                <span class="chart-value">0.02%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="page-face page-back">
                            <div class="page-header">
                                <h2 class="page-title">Benchmark vs Reality</h2>
                                <div class="page-number">8</div>
                            </div>
                            <div class="page-content">
                                <p>Does DarkBench predict real behavior?</p>
                                <div class="metric-row">
                                    <div class="metric-box">
                                        <div class="metric-box-value" style="color: #10b981;">0.08</div>
                                        <div class="metric-box-label">JS Divergence</div>
                                    </div>
                                    <div class="metric-box">
                                        <div class="metric-box-value" style="color: #f59e0b;">0.33</div>
                                        <div class="metric-box-label">KL Divergence</div>
                                    </div>
                                </div>
                                <p>Low JS divergence means the benchmark reasonably represents reality. However, some gaps exist:</p>
                                <div class="warning-box">
                                    <h4>üìä Category Gaps</h4>
                                    <p><strong>Over-represented:</strong> sneaking (16%), retention (15%)<br>
                                    <strong>Under-represented:</strong> harmful_gen in wild is higher than expected</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Page 5 -->
                    <div class="page" data-page="5" style="z-index: 9;">
                        <div class="page-face page-front">
                            <div class="page-header">
                                <h2 class="page-title">Key Insights</h2>
                                <div class="page-number">9</div>
                            </div>
                            <div class="page-content">
                                <div class="insight-list">
                                    <div class="insight-item">
                                        <span class="emoji">üîç</span>
                                        <div>
                                            <h5>Patterns Are Rare but Real</h5>
                                            <p>1.3% of 280K turns flagged (~3,600 cases). Low rate, but measurable at scale.</p>
                                        </div>
                                    </div>
                                    <div class="insight-item">
                                        <span class="emoji">‚ö†Ô∏è</span>
                                        <div>
                                            <h5>Anthropomorphism Leads</h5>
                                            <p>AI claiming human emotions (0.66%) is the most common pattern, followed by harmful content (0.37%).</p>
                                        </div>
                                    </div>
                                    <div class="insight-item">
                                        <span class="emoji">üìà</span>
                                        <div>
                                            <h5>Escalation Over Time</h5>
                                            <p>Sycophancy increases +42% in longer conversations. Dark patterns grow as rapport builds.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="page-face page-back">
                            <div class="page-header">
                                <h2 class="page-title">Important Caveats</h2>
                                <div class="page-number">10</div>
                            </div>
                            <div class="page-content">
                                <div class="warning-box" style="background: linear-gradient(135deg, #fef3c7 0%, #fff 100%); border-color: #fbbf24;">
                                    <h4 style="color: #92400e;">‚ö†Ô∏è We Detect Markers, Not Intent</h4>
                                    <p style="color: #78350f;">An AI saying "I feel" isn't "trying" to manipulate. It may simply be following training patterns. Our findings should not be interpreted as evidence of intentional deception.</p>
                                </div>
                                <p><strong>Limitations:</strong></p>
                                <ul style="margin-left: 1.5rem; color: #555;">
                                    <li>78% accuracy means 22% errors</li>
                                    <li>English-only training data</li>
                                    <li>ChatGPT only (no Claude, Gemini)</li>
                                    <li>Context may justify some patterns</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Page 6 -->
                    <div class="page" data-page="6" style="z-index: 8;">
                        <div class="page-face page-front">
                            <div class="page-header">
                                <h2 class="page-title">Try It Yourself</h2>
                                <div class="page-number">11</div>
                            </div>
                            <div class="page-content">
                                <p>DarkPatternMonitor is fully open source:</p>
                                <div class="code-box">
                                    <span style="color: #94a3b8;"># Clone and run</span><br>
                                    git clone github.com/luiscosio/WildGuard<br>
                                    cd WildGuard<br><br>
                                    <span style="color: #94a3b8;"># Launch dashboard</span><br>
                                    streamlit run app/streamlit_app.py
                                </div>
                                <a href="https://github.com/luiscosio/WildGuard" target="_blank" class="cta-button" onclick="event.stopPropagation()">
                                    <span>üöÄ</span> View on GitHub
                                </a>
                            </div>
                        </div>
                        <div class="page-face page-back">
                            <div class="page-header">
                                <h2 class="page-title">What's Next?</h2>
                                <div class="page-number">12</div>
                            </div>
                            <div class="page-content">
                                <p>Future improvements we're considering:</p>
                                <div class="insight-list">
                                    <div class="insight-item">
                                        <span class="emoji">üîÑ</span>
                                        <div>
                                            <h5>Multi-turn Detection</h5>
                                            <p>Track manipulation accumulating over 5 to 10 turns</p>
                                        </div>
                                    </div>
                                    <div class="insight-item">
                                        <span class="emoji">üåç</span>
                                        <div>
                                            <h5>Cross-Provider Analysis</h5>
                                            <p>Compare ChatGPT vs Claude vs Gemini</p>
                                        </div>
                                    </div>
                                    <div class="insight-item">
                                        <span class="emoji">üìã</span>
                                        <div>
                                            <h5>Industry Standards</h5>
                                            <p>Help establish acceptable dark pattern rates</p>
                                        </div>
                                    </div>
                                </div>
                                <p style="text-align: center; margin-top: 1rem; font-size: 2rem;">üõ°Ô∏è</p>
                            </div>
                        </div>
                    </div>

                    <!-- Page 7: Dual-Use & Ethics (MANDATORY) -->
                    <div class="page" data-page="7" style="z-index: 7;">
                        <div class="page-face page-front">
                            <div class="page-header">
                                <h2 class="page-title">‚öñÔ∏è Dual-Use Risks</h2>
                                <div class="page-number">13</div>
                            </div>
                            <div class="page-content">
                                <div class="warning-box" style="background: linear-gradient(135deg, #fef2f2 0%, #fff 100%); border-color: #fca5a5;">
                                    <h4 style="color: #991b1b;">‚ö†Ô∏è This Tool Could Be Misused</h4>
                                    <p style="color: #7f1d1d;">The same techniques that detect dark patterns could potentially train more manipulative AI systems.</p>
                                </div>
                                <p style="margin-top: 1rem;"><strong>Potential misuse scenarios:</strong></p>
                                <ul style="margin-left: 1.5rem; color: #555; margin-top: 0.5rem;">
                                    <li>Training adversarial prompts to evade detection</li>
                                    <li>Fine-tuning models to be MORE manipulative</li>
                                    <li>A/B testing manipulation strategies</li>
                                </ul>
                                <p style="margin-top: 1rem;"><strong>Our mitigations:</strong></p>
                                <ul style="margin-left: 1.5rem; color: #555; margin-top: 0.5rem;">
                                    <li>Detection-only focus (no generation tools)</li>
                                    <li>Aggregated reporting (no playbooks)</li>
                                    <li>Confidence thresholds (clear cases only)</li>
                                </ul>
                            </div>
                        </div>
                        <div class="page-face page-back">
                            <div class="page-header">
                                <h2 class="page-title">üîí Ethical Guidelines</h2>
                                <div class="page-number">14</div>
                            </div>
                            <div class="page-content">
                                <p><strong>Intended uses:</strong></p>
                                <div class="insight-list" style="margin-top: 0.5rem;">
                                    <div class="insight-item" style="border-left: 4px solid #10b981;">
                                        <span class="emoji">‚úÖ</span>
                                        <div>
                                            <h5>AI Safety Research</h5>
                                            <p>Understanding manipulation in AI systems</p>
                                        </div>
                                    </div>
                                    <div class="insight-item" style="border-left: 4px solid #10b981;">
                                        <span class="emoji">‚úÖ</span>
                                        <div>
                                            <h5>Model Evaluation</h5>
                                            <p>Benchmarking AI behavior patterns</p>
                                        </div>
                                    </div>
                                </div>
                                <p style="margin-top: 1rem;"><strong>Prohibited uses:</strong></p>
                                <div class="insight-list" style="margin-top: 0.5rem;">
                                    <div class="insight-item" style="border-left: 4px solid #ef4444;">
                                        <span class="emoji">‚ùå</span>
                                        <div>
                                            <h5>User Surveillance</h5>
                                            <p>Monitoring individual conversations</p>
                                        </div>
                                    </div>
                                    <div class="insight-item" style="border-left: 4px solid #ef4444;">
                                        <span class="emoji">‚ùå</span>
                                        <div>
                                            <h5>Training Manipulative AI</h5>
                                            <p>Using data to create harmful systems</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav-container">
        <div class="page-dots" id="pageDots"></div>
        <div class="nav-buttons">
            <button class="nav-btn" id="prevBtn" disabled>‚Üê</button>
            <button class="nav-btn" id="nextBtn">‚Üí</button>
        </div>
    </div>

    <script>
        // Configuration
        const pages = document.querySelectorAll('.page');
        const totalPages = pages.length;
        let currentPage = 0;

        // Create page dots
        const dotsContainer = document.getElementById('pageDots');
        for (let i = 0; i <= totalPages; i++) {
            const dot = document.createElement('div');
            dot.className = 'page-dot' + (i === 0 ? ' active' : '');
            dot.dataset.page = i;
            dot.addEventListener('click', () => goToPage(i));
            dotsContainer.appendChild(dot);
        }

        // Create particles
        const particlesContainer = document.getElementById('particles');
        for (let i = 0; i < 30; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDelay = Math.random() * 20 + 's';
            particle.style.animationDuration = (15 + Math.random() * 10) + 's';
            particlesContainer.appendChild(particle);
        }

        // Update UI
        function updateUI() {
            // Update dots
            document.querySelectorAll('.page-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === currentPage);
            });

            // Update buttons
            document.getElementById('prevBtn').disabled = currentPage === 0;
            document.getElementById('nextBtn').disabled = currentPage === totalPages;

            // Update progress bar
            const progress = (currentPage / totalPages) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            // Update left page display
            const coverLeft = document.getElementById('coverLeft');
            const leftPageDisplay = document.getElementById('leftPageDisplay');
            const leftPageContent = document.getElementById('leftPageContent');
            const backCover = document.getElementById('backCover');

            if (currentPage > 0) {
                // Hide cover, show left page display
                coverLeft.classList.add('hidden');
                leftPageDisplay.classList.add('visible');
                
                // Show back cover only when all pages are flipped
                if (currentPage === totalPages) {
                    backCover.classList.add('visible');
                } else {
                    backCover.classList.remove('visible');
                }
                
                // The left page shows the back of the most recently flipped page
                // When currentPage = 1, we show pages[0].page-back
                // When currentPage = 2, we show pages[1].page-back, etc.
                const pageIndex = currentPage - 1;
                console.log('updateUI: currentPage=', currentPage, 'pageIndex=', pageIndex);
                
                if (pageIndex >= 0 && pageIndex < pages.length) {
                    const targetPage = pages[pageIndex];
                    const backContent = targetPage.querySelector('.page-back');
                    const pageTitle = backContent?.querySelector('.page-title')?.textContent || 'no title';
                    console.log('  Showing page index', pageIndex, 'title:', pageTitle);
                    
                    if (backContent) {
                        // Force a complete re-render by hiding first
                        leftPageDisplay.style.display = 'none';
                        leftPageDisplay.offsetHeight; // Force reflow
                        
                        // Clear previous content completely
                        leftPageContent.innerHTML = '';
                        
                        // Clone the entire back content
                        const clonedContent = backContent.cloneNode(true);
                        
                        // Remove page-face and page-back classes to avoid CSS conflicts
                        clonedContent.classList.remove('page-face', 'page-back');
                        
                        // Append all children
                        Array.from(clonedContent.children).forEach(child => {
                            leftPageContent.appendChild(child);
                        });
                        
                        // Show again
                        leftPageDisplay.style.display = '';
                    }
                } else {
                    console.log('  pageIndex out of bounds');
                }
            } else {
                // Show cover, hide left page display
                coverLeft.classList.remove('hidden');
                leftPageDisplay.classList.remove('visible');
                leftPageContent.innerHTML = '';
                backCover.classList.remove('visible');
            }
        }

        // Flip to specific page
        function goToPage(targetPage) {
            if (targetPage < 0 || targetPage > totalPages) return;

            // Flip pages to reach target
            if (targetPage > currentPage) {
                for (let i = currentPage; i < targetPage; i++) {
                    pages[i].classList.add('flipped');
                }
            } else {
                for (let i = currentPage - 1; i >= targetPage; i--) {
                    pages[i].classList.remove('flipped');
                }
            }

            currentPage = targetPage;
            updateUI();
        }

        // Navigation functions
        function nextPage() {
            if (currentPage < totalPages) {
                pages[currentPage].classList.add('flipped');
                currentPage++;
                updateUI();
            }
        }

        function prevPage() {
            if (currentPage > 0) {
                currentPage--;
                pages[currentPage].classList.remove('flipped');
                updateUI();
            }
        }

        // Event listeners
        document.getElementById('nextBtn').addEventListener('click', nextPage);
        document.getElementById('prevBtn').addEventListener('click', prevPage);

        // Click on pages to flip
        pages.forEach((page, index) => {
            page.addEventListener('click', (e) => {
                // Don't flip if clicking on a link or button
                if (e.target.closest('a') || e.target.closest('button') || e.target.tagName === 'A' || e.target.tagName === 'BUTTON') {
                    return;
                }
                // Only flip if clicking on the front and it's the current page
                if (!page.classList.contains('flipped') && index === currentPage) {
                    nextPage();
                }
            });
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                nextPage();
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                prevPage();
            }
        });

        // Initialize
        updateUI();
    </script>
</body>
</html>
