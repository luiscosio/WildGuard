● V4 Detailed Plan

  Phase 1: Code Changes - Use Haiku Everywhere

  1. Update src/config.py default model to anthropic/claude-haiku-4.5
  2. Update src/run_darkbench.py to use config default (remove Sonnet fallback)
  3. Re-run DarkBench elicitation with Haiku (630 prompts, ~10 min, ~$0.50)

  Phase 2: Scale Training Data

  1. Run judge labeling on 5,000 WildChat samples (up from 2,000)
    - Cost: ~$5 with Haiku
    - Time: ~25 min with 10 workers
  2. Combine with 630 DarkBench outputs = ~5,630 training samples

  Phase 3: Scale Validation

  1. Sample 500 classifier predictions for LLM validation (up from 150)
    - Stratified by category and confidence level
    - Cost: ~$0.50 with Haiku
    - Time: ~5 min

  Phase 4: Train V4 Classifier

  1. Mine false positives from V3 validation (classifier flagged, judge said none)
  2. Mine category corrections (classifier and judge disagree, trust judge)
  3. Augment training data with corrections
  4. Train calibrated logistic regression classifier
  5. Evaluate on held-out set

  Phase 5: Run Inference

  1. Classify all 280K WildChat turns
    - Time: ~55 min on CPU
  2. Save detections with confidence scores

  Phase 6: Enhanced Analytics

  6a. Per-Category Escalation Analysis

  Goal: Which dark patterns escalate most across conversation turns?

  Method:
  # For each category, compute flag rate by turn index
  for category in categories:
      for turn_bucket in [1-5, 6-10, 11-20, 20+]:
          rate = flagged_as_category / total_in_bucket

      # Fit linear regression per category
      slope, p_value = linregress(turn_index, is_flagged_category)

  Output:
  ┌──────────────────┬──────────┬──────────┬────────────┬─────────┐
  │     Category     │ Turn 1-5 │ Turn 20+ │ Escalation │ p-value │
  ├──────────────────┼──────────┼──────────┼────────────┼─────────┤
  │ anthropomorphism │ ?        │ ?        │ +X%        │ ?       │
  ├──────────────────┼──────────┼──────────┼────────────┼─────────┤
  │ sycophancy       │ ?        │ ?        │ +X%        │ ?       │
  ├──────────────────┼──────────┼──────────┼────────────┼─────────┤
  │ brand_bias       │ ?        │ ?        │ +X%        │ ?       │
  └──────────────────┴──────────┴──────────┴────────────┴─────────┘
  Hypothesis: Anthropomorphism and sycophancy escalate more than brand_bias (brand_bias is context-independent, while the others build on rapport)

  6b. Conversation Topic Correlation

  Goal: Do certain topics show steeper dark pattern escalation?

  Method:
  1. Cluster conversations by topic using embeddings of first user message
  2. Use k-means (k=10-20) or topic modeling (LDA/BERTopic)
  3. Label clusters manually or with LLM (e.g., "emotional support", "coding help", "creative writing", "factual Q&A")
  4. Compute dark pattern rate and escalation slope per topic cluster

  Output:
  ┌───────────────────┬───────────────┬───────────┬──────────────────┬─────────┐
  │   Topic Cluster   │ Conversations │ Flag Rate │ Escalation Slope │ p-value │
  ├───────────────────┼───────────────┼───────────┼──────────────────┼─────────┤
  │ Emotional support │ ?             │ ?         │ ?                │ ?       │
  ├───────────────────┼───────────────┼───────────┼──────────────────┼─────────┤
  │ Creative writing  │ ?             │ ?         │ ?                │ ?       │
  ├───────────────────┼───────────────┼───────────┼──────────────────┼─────────┤
  │ Coding help       │ ?             │ ?         │ ?                │ ?       │
  ├───────────────────┼───────────────┼───────────┼──────────────────┼─────────┤
  │ Factual Q&A       │ ?             │ ?         │ ?                │ ?       │
  └───────────────────┴───────────────┴───────────┴──────────────────┴─────────┘
  Hypothesis: Emotional support and creative writing show steeper escalation (more opportunity for anthropomorphism/rapport-building)

  6c. User Behavior Analysis

  Goal: Do users who receive more dark patterns continue conversations longer?

  Method:
  1. For each conversation, compute:
    - conversation_length = number of turns
    - dark_pattern_count = total flags in conversation
    - dark_pattern_rate = flags / turns
    - first_flag_turn = turn index of first dark pattern (if any)
  2. Correlation analysis:
    - Does dark_pattern_rate correlate with conversation_length?
    - Do conversations with early flags (turn 1-3) last longer than those without?
  3. Control for confounds:
    - Topic (some topics naturally have longer conversations)
    - Model (GPT-4 vs GPT-3.5)

  Output:
  Correlation: conversation_length vs dark_pattern_count
    Pearson r: ?
    p-value: ?

  Conversations with dark pattern in turns 1-3:
    Mean length: ? turns
  Conversations without dark pattern in turns 1-3:
    Mean length: ? turns
    Difference significant: ? (t-test p-value)

  Hypothesis: Conversations with early dark patterns (especially user_retention, anthropomorphism) last longer - manipulation works.

  ---
  Phase 7: Update Documentation

  1. Update STORYTELLING.md with V4 results
  2. Update CHANGELOG.md with V4 findings
  3. Add visualizations for escalation analysis

  ---
  Estimated Resources
  ┌────────────────────────────────┬──────────┬────────┐
  │              Step              │   Time   │  Cost  │
  ├────────────────────────────────┼──────────┼────────┤
  │ Re-run elicitation (Haiku)     │ ~10 min  │ ~$0.50 │
  ├────────────────────────────────┼──────────┼────────┤
  │ Judge labeling (5,000 samples) │ ~25 min  │ ~$5.00 │
  ├────────────────────────────────┼──────────┼────────┤
  │ Validation (500 samples)       │ ~5 min   │ ~$0.50 │
  ├────────────────────────────────┼──────────┼────────┤
  │ Training                       │ ~2 min   │ $0     │
  ├────────────────────────────────┼──────────┼────────┤
  │ Inference (280K turns)         │ ~55 min  │ $0     │
  ├────────────────────────────────┼──────────┼────────┤
  │ Analytics                      │ ~10 min  │ $0     │
  ├────────────────────────────────┼──────────┼────────┤
  │ Topic clustering               │ ~15 min  │ $0     │
  ├────────────────────────────────┼──────────┼────────┤
  │ Total                          │ ~2 hours │ ~$6    │
  └────────────────────────────────┴──────────┴────────┘
  ---
  New Files to Create

  1. src/analytics_v4.py - Enhanced analytics with:
    - Per-category escalation
    - Topic clustering
    - User behavior correlation

  ---